<chapt> Installing and Configuring a Coda Client <p>
<label id="ClientInstall">
<p>
A Coda client can be run on any workstation that has kernel support
for Coda in its kernel.  This chapter assumes the chapter on <ref
id="KernelsforCoda" name="Configuring Kernels for use with Coda"> has
been read.  It contains valuable information for building a kernel if
a pre-built kernel with Coda support (or loadable coda kernel modules)
cannot be used. Supported UNIX&tm;-like platforms are currently Linux,
FreeBSD and NetBSD.

<sect>Installing and Configuring the Coda Client Binaries and Documentation<p>

We currently provide binary distributions of the Coda client software
for Red Hat Linux (i386 and Sparc), FreeBSD and NetBSD (i386).  
Red Hat Linux's rpm package format is supported.  NetBSD 1.3.X and FreeBSD
package format are supported as well.
Please consult the <tt>INSTALL.&lt;platform&gt;</tt> available on
<htmlurl url="ftp://ftp.coda.cs.cmu.edu/pub/coda" 
        name="ftp://ftp.coda.cs.cmu.edu/pub/coda"><tt>/&lt;platform&gt;</tt>
for the current version of Coda and for last minute updates which possibly  have not
made their way into the manual.  To install the binaries for each platform, 
the following instructions apply:

<descrip>

<tag/For Linux/
Obtain:
<htmlurl url="ftp://ftp.coda.cs.cmu.edu/pub/coda/linux/i386/" 
        name="ftp://ftp.coda.cs.cmu.edu/pub/coda/linux/i386/">
<itemize>
<item>
<tt>coda-debug-module-&lt;kernel_version&gt;-&lt;coda_release&gt;.i386.rpm</tt>
<item>
<tt>coda-debug-clients-&lt;kernel_version&gt;-&lt;coda_release&gt;.i386.rpm</tt>
<item><tt>coda-doc-&lt;coda_release&gt;.i386.rpm</tt>
</itemize>

<EM>NOTE:</EM> We provide a binary glibc (GNU C library) version of
Coda for Red Hat 5.X and higher.  Coda has run successfully on other
versions of Linux and with different C libraries too.
<p>
To install the binary and documentation packages, do:
<itemize>
<item>
<tt>rpm -Uvh coda-module-&lt;kernel_version&gt;-&lt;coda_release&gt;.i386.rpm</tt><item>
<tt>rpm -Uvh coda-debug-clients-&lt;kernel_version&gt;-&lt;coda_release&gt;.i386.rpm</tt>
<p>
<item><tt>rpm -Uvh coda-doc-&lt;coda_release&gt;.i386.rpm</tt>
</itemize>

<tag/FreeBSD and NetBSD:/
For FreeBSD, obtain:
<htmlurl url="ftp://ftp.coda.cs.cmu.edu/pub/coda/freebsd/" 
name="ftp://ftp.coda.cs.cmu.edu/pub/coda/freebsd/"><tt>&lt;OS-RELEASE&gt;/i386/</tt>
<p>

For NetBSD, obtain:
<htmlurl url="ftp://ftp.coda.cs.cmu.edu/pub/coda/netbsd/" 
    name="ftp://ftp.coda.cs.cmu.edu/pub/coda/netbsd/"><tt>&lt;OS-RELEASE&gt;/i386/</tt>
<p>
Once the binary and documentation packages have been obtained, the following
will install them:
<itemize>
<item>
<tt>pkg_add coda-clients-&lt;OS_RELEASE&gt;-&lt;coda_release&gt;/</tt>
<item>
<tt>tar zxfc coda-doc-&lt;coda_release&gt;.tgz -C /usr/share</tt>
</itemize>
<p>
Please make sure the correct path for your platform is set
in your environmental PATH variable:

</descrip>

<descrip>

<tag/For Linux:/
Coda installs in the standard /usr tree:
<tscreen><verb>
/usr/sbin
/usr/bin
</verb></tscreen>

<tag/For FreeBSD:/
Coda installs in the /usr/local tree:
<tscreen><verb>
/usr/local/sbin
/usr/local/bin
</verb></tscreen>
which is not usually part of the FreeBSD path search, particularly
for the root account.  Please make sure this is part of your
seach PATH.

<tag/NetBSD:/

Please note the NetBSD has elected to create a new tree to install
NetBSD packages into (NetBSD uses <tt>/usr/pkg</tt> instead of
<tt>/usr/local</tt>).  Coda creates package based on this
<tt>/usr/pkg</tt> tree.  Please make sure this tree is in your search
path as the /usr/pkg is not part of the default PATH settings under
NetBSD.

</descrip>

Once the binaries and documentation are installed, configuration of
Venus is identical for all platforms when 
<tt>venus-setup</tt> is used.  To run the script, type:

<tscreen><verb>
venus-setup <comma,seperated,list,of,servers> <cache_size_in_kilobytes>
</verb></tscreen>. For example,

<tscreen><verb>
venus-setup micky,minnie,goofy 40000
</verb></tscreen>

will setup up <tt>venus</tt> to look for the set of servers micky, minnie
and goofy and configure Venus to use 40MB of disk space for caching.  This
information is kept in <tt>/usr/coda/etc/vstab</tt>.

<em>NOTE:</em>At least one Coda server must be specified and the minimum 
cache size is 10MB ( <tt>10000</tt> ).

This script not only creates <tt>/usr/coda</tt>
and the necessary sub-directories, but creates <tt>/usr/coda/etc/vstab</tt>,
and adds necessary Coda port numbers to <tt>/etc/services</tt>.
<p>
To start venus for the first time, become root and issue the following
commands:
<tscreen><verb>
# venus -init &
# xterm -e tail -f /usr/coda/etc/console &
</verb></tscreen>
The last command allows you to monitor Venus as it reports messages
to <tt>/usr/coda/etc/console</tt>.

<sect>Upgrading from a previous Release<p>

If you are upgrading Coda from a previous release, do not
run <tt>venus-setup</tt> again!  Simply obtain
the packages for your platform as indicated above.  Then,
shutdown venus by becoming root and issue the following command:
<tscreen><verb>
# vutil -shutdown
</verb></tscreen>
Next, install the binary packages following the installation instructions 
above.  Make sure you have the appropriate kernel for *BSD systems
or the correct module for Linux systems.  The <tt>INSTALL.&lt;platform&gt;</tt>
document available from the ftp site will contain relevant notes about
upgrading the kernel for *BSD systems and the module for Linux systems.
INSTALL.&lt;platform&gt; will provide necessary advice on which 
kernel to use with a provided Coda release.

Also, the Chapter on <ref id="KernelsforCoda" name="Installing and Configuring
a kernel for use with Coda"> has information on configuring and building
a kernel kernel (or loadable module) if a pre-build kernel or module
won't work for the target platform.
<p>
Once the new binaries are installed and the any necessary kernel updates are
completed, you need to start the new venus for the first time by becoming
root and typing:
<tscreen><verb>
# venus -init &
</verb></tscreen>
The &lt;-init&gt; flag is used to re-initialize the 
<tt>/usr/coda/venus.cache/</tt>.
 
<sect>Configuration Changes made by venus-setup<p>

This section describes the changes that must be made to various 
configuration files.  Samples of the files are contained in Appendix 
<ref id="ExampleFiles" name="XXX">.

<sect1>/usr/coda/etc/vstab<p>
Create a <tt>vstab</tt> file in <tt>/usr/coda/etc</tt> to contain
the Coda file system table information.  The contents of this
file are explained in the man page <tt>vstab(5)</tt>.

<sect1>/etc/rc.*<p>
To automatically
start Venus at boot time, the script <tt>rc.venus</tt> is provided
in <tt>/usr/local/etc</tt> for FreeBSD systems and <tt>/usr/pkg/etc</tt> 
for NetBSD. <tt>venus.init</tt> is provided for Red 
Hat Linux in <tt>/etc/rc.d/init.d</tt>.  
<p>
Linux uses should create the following symbolic link if it doesn't already
exist:
<tscreen><verb>
ln -sf /etc/rc.d/init.d/venus.init /etc/rc.d/
</verb></tscreen>
This will allow <tt>init</tt> to process the file and start Venus
at boot time on Red Hat Linux systems.
<p>
*BSD systems should append the following line to <tt>/etc/rc.local</tt>:
<descrip>
<tag/For FreeBSD:/
<tscreen><verb>
if [ -f /usr/local/etc/rc.venus ]; then
	. /usr/local/etc/rc.venus
fi
</verb></tscreen>

<tag/For NetBSD:/
<tscreen><verb>
if [ -f /usr/pkg/etc/rc.venus ]; then
	. /usr/pkg/etc/rc.venus
fi
</verb></tscreen>

</descrip>

<sect1>/etc/services<p>

The following port numbers are added to <tt>/etc/services</tt> by
<tt>venus-setup</tt>:
<tscreen><verb>
coda_opcons     1355/udp                        # Coda opcons
coda_auth       1357/udp                        # Coda auth
coda_udpsrv     1359/udp                        # Coda udpsrv
coda_filesrv    1361/udp                        # Coda filesrv
coda_venus      1363/udp                        # Coda venus
coda_backup     1407/tcp                        # coda backup service
codacon         1423/tcp        venus.cmu       # Coda Console
coda_aux1       1431/tcp                        # coda auxiliary service
coda_aux1       1431/udp                        # coda auxiliary service
coda_aux2       1433/tcp                        # coda auxiliary service
coda_aux2       1433/udp                        # coda auxiliary service
coda_aux3       1435/tcp                        # coda auxiliary service
coda_aux3       1435/udp                        # coda auxiliary service
</verb></tscreen>

<sect1>/dev/cfs0<p>
The following major and minor numbers are used for the various
platforms:
<p>
<itemize>
<item>Character-special with Major 67 and minor 0 for Linux
<tscreen><verb>
# mknod /dev/cfs0 c 67 0
</verb></tscreen>
<item>Character-special with Major 93 and minor 0 for FreeBSD
<tscreen><verb>
# mknod /dev/cfs0 c 93 0
</verb></tscreen>
<item>Character-special with Major 46 and minor 0 for NetBSD 1.2
<tscreen><verb>
# mknod /dev/cfs0 c 46 0
</verb></tscreen>
<item>Character-special with Major 51 and minor 0 for NetBSD 1.3
<tscreen><verb>
# mknod /dev/cfs0 c 51 0
</verb></tscreen>
</itemize>
Please be sure to check the <tt>INSTALL.&lt;platform&gt;</tt> to make
sure these numbers have not changed.  For Linux and FreeBSD, the above
numbers are officially registered.  Coda on NetBSD at present does not
have formally registered major device numbers so these are subject to
change from release to release.

<sect>Where Data and Configuration Information is Stored<p>
<itemize>
<item>
<tt>/usr/coda/etc</tt> Coda configuration files critical for Venus startup.
<item>
<tt>/usr/coda/venus.cache</tt> Cached copies of Coda files.
<item>
<tt>/usr/coda/spool</tt> Save CMLs from aborted reintegrations.
<item><tt>/usr/coda/tmp</tt> Temporary hoard related files.
<item>
<tt>/etc/services</tt> Various port numbers used by Coda for client
and server communication.
</itemize>
