
datarootdir = @datarootdir@
mandir = @mandir@

create_container = @top_srcdir@/scripts/create_container2
DOCDIR = @abs_top_builddir@/install

all:   FORCE
	@echo "Targets are: manpages, psdocs, htmldocs"
	@echo "Install targets: man-install, ps-install, html-install, ppt-install"

# debugging aid
printenv: FORCE
	echo MANPAGEFILES: $(MANPAGEFILES)
	echo SUBDIRS: $(SUBDIRS)
	echo DOCDIR: $(DOCDIR)

# build the documents (rules below)
manpages: $(MANPAGEFILES) $(SUBDIRS)
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done

psdocs: $(PSDOCS) $(SUBDIRS)
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done

htmldocs: $(HTMLDOCS) $(SUBDIRS)
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done

# install the docs
ppt-install: $(PPTDOCS) $(SUBDIRS)
	-mkdir -p $(DOCDIR)/ppt
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done
ifdef PPTDOCS
	install $(PPTDOCS) $(DOCDIR)/ppt
endif

ps-install: $(PSDOCS) $(SUBDIRS)
	-mkdir -p $(DOCDIR)/ps
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done
ifdef PSDOCS
	install $(PSDOCS) $(DOCDIR)/ps
	gzip -f $(DOCDIR)/ps/*.ps
endif

html-install: $(HTMLDOCS) $(SUBDIRS)
	-mkdir -p $(DOCDIR)/html
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done
ifdef HTMLDOCS
	install *.html $(DOCDIR)/html
endif

man-install: manpages
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done
ifdef MANPAGEFILES
	-mkdir -p $(prefix)/man
	-mkdir -p $(prefix)/man/man$(CH)
	install -m 644 -o root -g bin $(MANPAGEFILES) $(mandir)/man$(CH)
endif

install: ps-install ppt-install html-install man-install

# clean
clean:
	for i in $(SUBDIRS) ; do make -w -C $$i $@ ; done
	rm -f *.sgml.cntr *.sgml.cntr.man *.man __tmp.sgml *.html *.dvi *.log *.aux *.tex $(MANPAGEFILES) $(PSDOCS)

distclean: 
	make clean
	find . -name Makefile -exec rm {} \;
	rm Makerules

# rules
%.html: %.sgml
	sgml2html $(HTMLARGS) $?

%.ps: %.sgml
	sgml2latex --output=ps $?

%.sgml.cntr: %.sgml
	$(create_container) $?

%.1 %.2 %.3 %.4 %.5 %.8 %.man: %.sgml.cntr
	mv $? __tmp.sgml
	sgml2txt -man __tmp.sgml
	mv __tmp.man $@

FORCE:
