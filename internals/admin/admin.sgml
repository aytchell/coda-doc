<!doctype linuxdoc SYSTEM  [

<!entity % latex "INCLUDE">
<!entity % html  "IGNORE">
<![ %latex; [ <!entity newpage PI "\newpage"> ]]>
<![ %html; [ <!entity newpage PI "<HR>"> ]]>
<!entity newpage PI "">
]>

<article>



<title> Coda System Administration
<author> Peter J. Braam and  Henry M. Pierce
<date>v1.1, Nov 9, 1997

<abstract> This document describes the current implementation of the
Coda system administration, it's problems and ideas for future design.
</abstract>

<toc>
&newpage;<sect> Introduction <P> 

<itemize>
<item> Volume databases (text) 
<item> <tt>/vice/vol/VolumeList</tt> Holds partition and volume
information for volumes for which this server is custodian.  This is
file is generated by srv.   
<item> <tt> /vice/vol/groupid</tt> is maximum replicated volume id
allocated so far.  
<item> HOSTS (text) 
<itemize>
<item> Entries describe volume storage groups: 
 id  hostname1 hostname2 etc.  Stored in /vice/db/VSGDB
<item> <tt>/vice/db/hosts</tt> servers should be in this file.  Servers found in the VSGDB are checked to be in this file before proceeding to make a volume. 
<item> <tt> /vice/db/servers</tt> contains an id for each server. 
</itemize>


</itemize>

Createvol_rep works as follows:
Parameters are: &lt;volname&gt; &lt;vsgaddr&gt; &lt;partitionname&gt; &lsqb; &lt;groupid&gt; ]
<itemize>
<item> check we are the SCM
<item> Check that the volname doesn't appear in AllVolumes or VRList
<item> Get the list of servers from the vsgaddr using the VSGDB
<item> verify the servers against /vice/db/hosts
<item> get a new replicated id for this replicated volume using the
<tt> /vice/vol/groupid</tt> file
<item> use volutil to create the volume on each host, using the
partition, volumename and groupid acquired before. Note that each server now
assigns a volume id for this newly created volume.  It dumps
</itemize>

<sect1> 
bldvldb.sh <P>
<itemize>
<item> get <tt> /vice/vol/VolumeList </tt> from each server in <tt>
/vice/db/hosts</tt>. Names is server-name.list.new. First try this using
ftp, then rfs, then krcp. 
<item> if the file was acquired move it to <tt>
/vice/vol/remote/server-name.list</tt>
<item> dump them all in <tt>/vice/vol/BigVolumeList</tt>
<item> volutil rebuilds the VLDB with <tt> volutil makevldb
/vice/vol/BigVolumeList</tt> 
</itemize> 

Note this rebuilds the VLDB on the machine where is script is run,
i.e. the scm. 

</article>
